<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Utmify - Verifica√ß√£o Completa</title>
</head>
<body>
    <h1>Debug Utmify - Verifica√ß√£o Completa</h1>
    
    <div id="results"></div>
    
    <h2>Links de teste:</h2>
    <p><a href="?utm_source=facebook&utm_campaign=teste&utm_medium=cpc" target="_blank">Teste com UTM</a></p>
    <p><a href="?utm_source=google&utm_campaign=ads" target="_blank">Teste com Google UTM</a></p>
    
    <button onclick="checkAll()">Verificar Tudo</button>
    <button onclick="forceUtmify()">For√ßar Utmify</button>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.innerHTML = `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
            results.appendChild(div);
            console.log(message);
        }
        
        function getAllCookies() {
            return document.cookie.split(';').reduce((acc, cookie) => {
                const [key, value] = cookie.trim().split('=');
                acc[key] = decodeURIComponent(value || '');
                return acc;
            }, {});
        }
        
        function checkAll() {
            log('üîç === VERIFICA√á√ÉO COMPLETA ===');
            
            // 1. Verificar URL atual
            log('1Ô∏è‚É£ Verificando URL atual:');
            log(`URL: ${window.location.href}`);
            const urlParams = new URLSearchParams(window.location.search);
            const urlUtm = {
                utm_source: urlParams.get('utm_source'),
                utm_campaign: urlParams.get('utm_campaign'),
                utm_medium: urlParams.get('utm_medium'),
                utm_content: urlParams.get('utm_content'),
                utm_term: urlParams.get('utm_term')
            };
            log(`Par√¢metros UTM na URL: ${JSON.stringify(urlUtm)}`);
            
            // 2. Verificar todos os cookies
            log('2Ô∏è‚É£ Verificando todos os cookies:');
            const allCookies = getAllCookies();
            log(`Total de cookies: ${Object.keys(allCookies).length}`);
            Object.entries(allCookies).forEach(([key, value]) => {
                log(`üç™ ${key}: ${value}`);
            });
            
            // 3. Verificar cookies UTM espec√≠ficos
            log('3Ô∏è‚É£ Verificando cookies UTM espec√≠ficos:');
            const utmifyCookies = [
                'utm_source',
                'utm_campaign', 
                'utm_medium',
                'utm_content',
                'utm_term',
                'utmify_source',
                'utmify_campaign',
                'utmify_medium',
                'utmify_content',
                'utmify_term'
            ];
            
            utmifyCookies.forEach(cookieName => {
                const value = allCookies[cookieName];
                if (value) {
                    log(`‚úÖ ${cookieName}: ${value}`);
                } else {
                    log(`‚ùå ${cookieName}: n√£o encontrado`);
                }
            });
            
            // 4. Verificar se Utmify est√° carregado
            log('4Ô∏è‚É£ Verificando se Utmify est√° carregado:');
            log(`window.utmify: ${window.utmify ? 'presente' : 'ausente'}`);
            log(`window.utmifyLoaded: ${window.utmifyLoaded ? 'true' : 'false'}`);
            log(`typeof window.utmify: ${typeof window.utmify}`);
            
            // 5. Verificar se h√° scripts Utmify na p√°gina
            log('5Ô∏è‚É£ Verificando scripts Utmify na p√°gina:');
            const scripts = document.querySelectorAll('script');
            let utmifyScriptFound = false;
            scripts.forEach(script => {
                if (script.src && script.src.includes('utmify')) {
                    log(`‚úÖ Script Utmify encontrado: ${script.src}`);
                    utmifyScriptFound = true;
                }
            });
            if (!utmifyScriptFound) {
                log('‚ùå Nenhum script Utmify encontrado na p√°gina');
            }
            
            // 6. Verificar se h√° erros no console
            log('6Ô∏è‚É£ Verificando erros no console:');
            const originalError = console.error;
            const errors = [];
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };
            
            setTimeout(() => {
                if (errors.length > 0) {
                    errors.forEach(error => log(`‚ùå Erro: ${error}`));
                } else {
                    log('‚úÖ Nenhum erro encontrado');
                }
                console.error = originalError;
            }, 1000);
        }
        
        function forceUtmify() {
            log('üîÑ For√ßando cria√ß√£o de cookies UTM...');
            
            // Simular cria√ß√£o de cookies como o Utmify faria
            const urlParams = new URLSearchParams(window.location.search);
            const utmParams = {
                utm_source: urlParams.get('utm_source') || 'organic',
                utm_campaign: urlParams.get('utm_campaign') || '',
                utm_medium: urlParams.get('utm_medium') || '',
                utm_content: urlParams.get('utm_content') || '',
                utm_term: urlParams.get('utm_term') || ''
            };
            
            log(`Par√¢metros UTM capturados: ${JSON.stringify(utmParams)}`);
            
            // Criar cookies manualmente
            if (utmParams.utm_source && utmParams.utm_source !== 'organic') {
                document.cookie = `utm_source=${encodeURIComponent(utmParams.utm_source)}; path=/; max-age=2592000`;
                log(`‚úÖ Cookie utm_source criado: ${utmParams.utm_source}`);
            }
            
            if (utmParams.utm_campaign) {
                document.cookie = `utm_campaign=${encodeURIComponent(utmParams.utm_campaign)}; path=/; max-age=2592000`;
                log(`‚úÖ Cookie utm_campaign criado: ${utmParams.utm_campaign}`);
            }
            
            if (utmParams.utm_medium) {
                document.cookie = `utm_medium=${encodeURIComponent(utmParams.utm_medium)}; path=/; max-age=2592000`;
                log(`‚úÖ Cookie utm_medium criado: ${utmParams.utm_medium}`);
            }
            
            if (utmParams.utm_content) {
                document.cookie = `utm_content=${encodeURIComponent(utmParams.utm_content)}; path=/; max-age=2592000`;
                log(`‚úÖ Cookie utm_content criado: ${utmParams.utm_content}`);
            }
            
            if (utmParams.utm_term) {
                document.cookie = `utm_term=${encodeURIComponent(utmParams.utm_term)}; path=/; max-age=2592000`;
                log(`‚úÖ Cookie utm_term criado: ${utmParams.utm_term}`);
            }
            
            setTimeout(() => {
                log('üîÑ Verificando cookies ap√≥s cria√ß√£o manual...');
                checkAll();
            }, 500);
        }
        
        // Verifica√ß√£o autom√°tica
        setTimeout(() => {
            log('üîÑ Verifica√ß√£o autom√°tica ap√≥s carregamento...');
            checkAll();
        }, 2000);
        
        // Verifica√ß√£o peri√≥dica
        setInterval(() => {
            log('üîÑ Verifica√ß√£o peri√≥dica...');
            const allCookies = getAllCookies();
            const utmCookies = Object.keys(allCookies).filter(key => 
                key.startsWith('utm_') || key.startsWith('utmify_')
            );
            if (utmCookies.length > 0) {
                log(`‚úÖ Cookies UTM encontrados: ${utmCookies.join(', ')}`);
            } else {
                log('‚ùå Nenhum cookie UTM encontrado');
            }
        }, 5000);
    </script>
    
    <!-- Utmify Script -->
    <script src="https://cdn.utmify.com.br/scripts/utms/latest.js" data-utmify-prevent-subids async defer></script>
</body>
</html> 