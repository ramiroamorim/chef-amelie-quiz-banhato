<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Simples Utmify</title>
</head>
<body>
    <h1>Teste Simples - Utmify</h1>
    
    <div id="results"></div>
    
    <button onclick="testUtmCapture()">Testar Captura UTM</button>
    <button onclick="testCheckoutUrl()">Testar URL Checkout</button>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.innerHTML = `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
            results.appendChild(div);
            console.log(message);
        }
        
        // FunÃ§Ã£o similar Ã  getUtmParams do projeto
        function getUtmParams() {
            log('ðŸ” getUtmParams - Iniciando leitura dos cookies');
            
            const cookies = document.cookie.split(';').reduce((acc, cookie) => {
                const [key, value] = cookie.trim().split('=');
                acc[key] = decodeURIComponent(value || '');
                return acc;
            }, {});
            
            log('ðŸ” getUtmParams - Todos os cookies:', cookies);
            
            const utmParams = {
                utm_source: cookies.utm_source || cookies.utmify_source || 'organic',
                utm_campaign: cookies.utm_campaign || cookies.utmify_campaign || '',
                utm_medium: cookies.utm_medium || cookies.utmify_medium || '',
                utm_content: cookies.utm_content || cookies.utmify_content || '',
                utm_term: cookies.utm_term || cookies.utmify_term || ''
            };
            
            log('ðŸ” getUtmParams - ParÃ¢metros UTM extraÃ­dos:', utmParams);
            return utmParams;
        }
        
        // FunÃ§Ã£o similar Ã  buildHotmartUrl do projeto
        function buildHotmartUrl(utmParams) {
            const baseUrl = 'https://pay.hotmart.com/D98080625O?off=1n1vmmyz&checkoutMode=10';
            const urlParams = new URLSearchParams();
            
            log('ðŸ” buildHotmartUrl - Iniciando construÃ§Ã£o da URL');
            log('ðŸ” buildHotmartUrl - ParÃ¢metros UTM recebidos:', utmParams);
            
            // ParÃ¢metros UTM
            if (utmParams.utm_source && utmParams.utm_source !== 'organic') {
                urlParams.append('utm_source', utmParams.utm_source);
                log('âœ… buildHotmartUrl - Adicionado utm_source:', utmParams.utm_source);
            }
            
            if (utmParams.utm_campaign && utmParams.utm_campaign.trim() !== '') {
                urlParams.append('utm_campaign', utmParams.utm_campaign);
                log('âœ… buildHotmartUrl - Adicionado utm_campaign:', utmParams.utm_campaign);
            }
            
            if (utmParams.utm_medium && utmParams.utm_medium.trim() !== '') {
                urlParams.append('utm_medium', utmParams.utm_medium);
                log('âœ… buildHotmartUrl - Adicionado utm_medium:', utmParams.utm_medium);
            }
            
            if (utmParams.utm_content && utmParams.utm_content.trim() !== '') {
                urlParams.append('utm_content', utmParams.utm_content);
                log('âœ… buildHotmartUrl - Adicionado utm_content:', utmParams.utm_content);
            }
            
            if (utmParams.utm_term && utmParams.utm_term.trim() !== '') {
                urlParams.append('utm_term', utmParams.utm_term);
                log('âœ… buildHotmartUrl - Adicionado utm_term:', utmParams.utm_term);
            }
            
            const queryString = urlParams.toString();
            const finalUrl = queryString ? `${baseUrl}&${queryString}` : baseUrl;
            
            log('ðŸ” buildHotmartUrl - Query string gerada:', queryString);
            log('ðŸ” buildHotmartUrl - URL final:', finalUrl);
            
            return finalUrl;
        }
        
        function testUtmCapture() {
            log('ðŸ§ª TESTE: Captura de parÃ¢metros UTM');
            const utmParams = getUtmParams();
            
            const hasValidParams = utmParams.utm_source !== 'organic' || 
                                 utmParams.utm_campaign !== '' || 
                                 utmParams.utm_medium !== '' || 
                                 utmParams.utm_content !== '' || 
                                 utmParams.utm_term !== '';
            
            if (hasValidParams) {
                log('âœ… TESTE: ParÃ¢metros UTM vÃ¡lidos encontrados!');
            } else {
                log('âŒ TESTE: Nenhum parÃ¢metro UTM vÃ¡lido encontrado');
            }
        }
        
        function testCheckoutUrl() {
            log('ðŸ§ª TESTE: ConstruÃ§Ã£o da URL de checkout');
            const utmParams = getUtmParams();
            const checkoutUrl = buildHotmartUrl(utmParams);
            
            // Verificar se os parÃ¢metros UTM estÃ£o na URL final
            const urlObj = new URL(checkoutUrl);
            const utmSource = urlObj.searchParams.get('utm_source');
            const utmCampaign = urlObj.searchParams.get('utm_campaign');
            const utmMedium = urlObj.searchParams.get('utm_medium');
            
            log('ðŸ” TESTE: VerificaÃ§Ã£o final na URL:');
            log(`  - utm_source: ${utmSource}`);
            log(`  - utm_campaign: ${utmCampaign}`);
            log(`  - utm_medium: ${utmMedium}`);
            
            if (utmSource && utmSource !== 'organic') {
                log('âœ… TESTE: ParÃ¢metros UTM estÃ£o na URL de checkout!');
            } else {
                log('âŒ TESTE: ParÃ¢metros UTM NÃƒO estÃ£o na URL de checkout');
            }
        }
        
        // VerificaÃ§Ã£o automÃ¡tica apÃ³s carregamento
        setTimeout(() => {
            log('ðŸ”„ VerificaÃ§Ã£o automÃ¡tica apÃ³s carregamento...');
            testUtmCapture();
            testCheckoutUrl();
        }, 3000);
    </script>
    
    <!-- Utmify Script -->
    <script src="https://cdn.utmify.com.br/scripts/utms/latest.js" data-utmify-prevent-subids async defer></script>
</body>
</html> 