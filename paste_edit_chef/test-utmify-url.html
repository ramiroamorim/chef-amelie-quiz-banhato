<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste URL com UTM - Utmify</title>
</head>
<body>
    <h1>Teste URL com Par√¢metros UTM</h1>
    
    <div id="results"></div>
    
    <h2>Links de teste:</h2>
    <p><a href="?utm_source=facebook&utm_campaign=teste_campanha&utm_medium=cpc&utm_content=teste_conteudo&utm_term=teste_termo" target="_blank">Teste com par√¢metros UTM completos</a></p>
    <p><a href="?utm_source=google&utm_campaign=ads_campanha&utm_medium=search" target="_blank">Teste com par√¢metros UTM parciais</a></p>
    <p><a href="?utm_source=instagram&utm_campaign=stories" target="_blank">Teste com par√¢metros UTM m√≠nimos</a></p>
    
    <button onclick="checkCurrentUtm()">Verificar UTM Atual</button>
    <button onclick="simulateUtmify()">Simular Utmify</button>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.innerHTML = `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
            results.appendChild(div);
            console.log(message);
        }
        
        function getAllCookies() {
            return document.cookie.split(';').reduce((acc, cookie) => {
                const [key, value] = cookie.trim().split('=');
                acc[key] = decodeURIComponent(value || '');
                return acc;
            }, {});
        }
        
        function checkCurrentUtm() {
            log('üîç Verificando par√¢metros UTM atuais...');
            
            // Verificar URL atual
            const urlParams = new URLSearchParams(window.location.search);
            const urlUtm = {
                utm_source: urlParams.get('utm_source'),
                utm_campaign: urlParams.get('utm_campaign'),
                utm_medium: urlParams.get('utm_medium'),
                utm_content: urlParams.get('utm_content'),
                utm_term: urlParams.get('utm_term')
            };
            
            log('üîç Par√¢metros UTM na URL:', urlUtm);
            
            // Verificar cookies
            const allCookies = getAllCookies();
            log('üîç Todos os cookies:', allCookies);
            
            // Verificar cookies UTM espec√≠ficos
            const utmifyCookies = [
                'utm_source',
                'utm_campaign', 
                'utm_medium',
                'utm_content',
                'utm_term',
                'utmify_source',
                'utmify_campaign',
                'utmify_medium',
                'utmify_content',
                'utmify_term'
            ];
            
            log('üîç Verificando cookies UTM espec√≠ficos:');
            utmifyCookies.forEach(cookieName => {
                const value = allCookies[cookieName];
                if (value) {
                    log(`‚úÖ ${cookieName}: ${value}`);
                } else {
                    log(`‚ùå ${cookieName}: n√£o encontrado`);
                }
            });
            
            // Verificar se h√° par√¢metros v√°lidos
            const hasValidUrlParams = urlUtm.utm_source || urlUtm.utm_campaign || urlUtm.utm_medium;
            const hasValidCookies = allCookies.utm_source || allCookies.utmify_source;
            
            if (hasValidUrlParams) {
                log('‚úÖ Par√¢metros UTM v√°lidos na URL!');
            } else {
                log('‚ùå Nenhum par√¢metro UTM v√°lido na URL');
            }
            
            if (hasValidCookies) {
                log('‚úÖ Cookies UTM v√°lidos encontrados!');
            } else {
                log('‚ùå Nenhum cookie UTM v√°lido encontrado');
            }
        }
        
        function simulateUtmify() {
            log('üß™ Simulando comportamento do Utmify...');
            
            // Simular captura de par√¢metros UTM da URL
            const urlParams = new URLSearchParams(window.location.search);
            const utmParams = {
                utm_source: urlParams.get('utm_source') || 'organic',
                utm_campaign: urlParams.get('utm_campaign') || '',
                utm_medium: urlParams.get('utm_medium') || '',
                utm_content: urlParams.get('utm_content') || '',
                utm_term: urlParams.get('utm_term') || ''
            };
            
            log('üîç Par√¢metros UTM capturados da URL:', utmParams);
            
            // Simular cria√ß√£o de cookies (como o Utmify faria)
            if (utmParams.utm_source && utmParams.utm_source !== 'organic') {
                document.cookie = `utm_source=${encodeURIComponent(utmParams.utm_source)}; path=/; max-age=2592000`;
                log('‚úÖ Cookie utm_source criado:', utmParams.utm_source);
            }
            
            if (utmParams.utm_campaign) {
                document.cookie = `utm_campaign=${encodeURIComponent(utmParams.utm_campaign)}; path=/; max-age=2592000`;
                log('‚úÖ Cookie utm_campaign criado:', utmParams.utm_campaign);
            }
            
            if (utmParams.utm_medium) {
                document.cookie = `utm_medium=${encodeURIComponent(utmParams.utm_medium)}; path=/; max-age=2592000`;
                log('‚úÖ Cookie utm_medium criado:', utmParams.utm_medium);
            }
            
            if (utmParams.utm_content) {
                document.cookie = `utm_content=${encodeURIComponent(utmParams.utm_content)}; path=/; max-age=2592000`;
                log('‚úÖ Cookie utm_content criado:', utmParams.utm_content);
            }
            
            if (utmParams.utm_term) {
                document.cookie = `utm_term=${encodeURIComponent(utmParams.utm_term)}; path=/; max-age=2592000`;
                log('‚úÖ Cookie utm_term criado:', utmParams.utm_term);
            }
            
            // Verificar cookies ap√≥s simula√ß√£o
            setTimeout(() => {
                log('üîÑ Verificando cookies ap√≥s simula√ß√£o...');
                checkCurrentUtm();
            }, 100);
        }
        
        // Verifica√ß√£o autom√°tica ao carregar
        setTimeout(() => {
            log('üîÑ Verifica√ß√£o autom√°tica ao carregar...');
            checkCurrentUtm();
        }, 1000);
    </script>
    
    <!-- Utmify Script -->
    <script src="https://cdn.utmify.com.br/scripts/utms/latest.js" data-utmify-prevent-subids async defer></script>
</body>
</html> 